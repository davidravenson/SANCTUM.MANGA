<!-- SANCTUM Reader v0.29.0 -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SANCTUM — Chapter 00</title>
  <style>
    :root{
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --ui-radius: 18px;
      --panel-max: 1200px;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --glass: rgba(255,255,255,.12);
      --glass2: rgba(0,0,0,.35);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --paper-ok: rgba(120,255,160,.9);
    }

    html, body { height: 100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      overflow-x:hidden;

      /* Background: top space + paper texture */
      background:
        radial-gradient(1200px 520px at 50% -60px, rgba(255,255,255,.18), rgba(0,0,0,0) 60%),
        linear-gradient(to bottom, #000 0%, #000 28%, rgba(0,0,0,.75) 38%, rgba(0,0,0,.35) 52%, rgba(0,0,0,.12) 62%, rgba(0,0,0,0) 70%),
        url("./media/ui/manga_paper_bg.png");
      background-repeat: no-repeat, no-repeat, repeat;
      background-size: cover, cover, 780px auto;
      background-position: center top, center top, center top;
      background-attachment: scroll, scroll, scroll;
    }

    /* Subtle + stars (tiny crosses) in the top black area only */
    .stars{
      position: fixed;
      left:0; right:0; top:0;
      height: 38vh;
      pointer-events:none;
      opacity:.55;
      mix-blend-mode: screen;
      background-image:
        radial-gradient(circle at 14% 18%, rgba(255,255,255,.9) 0 1px, rgba(255,255,255,0) 2px),
        radial-gradient(circle at 72% 28%, rgba(255,255,255,.8) 0 1px, rgba(255,255,255,0) 2px),
        radial-gradient(circle at 42% 52%, rgba(255,255,255,.6) 0 1px, rgba(255,255,255,0) 2px);
      filter: blur(.2px);
    }

    .wrap{
      min-height: 100%;
      display:flex;
      flex-direction: column;
      align-items: center;
      padding: calc(14px + var(--safe-top)) 12px calc(22px + var(--safe-bottom)) 12px;
      box-sizing:border-box;
      gap: 14px;
    }

    /* PANEL STAGE: black buffers top/bottom to avoid seams */
    .stage{
      width: 100%;
      max-width: var(--panel-max);
      position: relative;
      display:flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0;
    }
    .buffer{
      width: 100%;
      height: 8vh;                /* black seam buffer */
      min-height: 56px;
      max-height: 120px;
      background: #000;
      border-radius: 0;
    }

    /* Panel: no white frame, full width as much as possible */
    .panel{
      width: 100%;
      background: transparent;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .panel img{
      width: 100%;
      height: auto;
      display:block;
      max-width: 100%;
      object-fit: contain;
      border-radius: 0;
      box-shadow: none;
      background: transparent;
      -webkit-user-drag: none;
      user-select: none;
    }

    /* Collapsible player dock that overlaps the lower black buffer */
    .playerDock{
      width: 100%;
      max-width: var(--panel-max);
      position: relative;
      margin-top: -52px; /* overlap ~50% into lower buffer */
      padding: 0 8px;
      box-sizing: border-box;
    }
    .dockCard{
      width: 100%;
      border-radius: 26px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow: hidden;
    }

    /* Collapsed header row (play button + track info) */
    .dockHeader{
      display:flex;
      align-items:center;
      gap: 12px;
      padding: 12px 14px;
      cursor: pointer;
      user-select:none;
    }
    .playPill{
      width: 44px;
      height: 44px;
      border-radius: 999px;
      background: rgba(0,0,0,.40);
      border: 1px solid rgba(255,255,255,.18);
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 0 0 auto;
    }
    .playPill svg{ width: 18px; height: 18px; fill: rgba(255,255,255,.92); }
    .trackText{
      line-height: 1.05;
      min-width: 0;
      flex: 1 1 auto;
    }
    .trackTitle{
      font-weight: 800;
      letter-spacing: .04em;
      font-size: 16px;
      color: rgba(0,0,0,.92);
      background: rgba(255,255,255,.78);
      display:inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      margin-bottom: 6px;
    }
    .trackArtist{
      font-weight: 700;
      font-size: 14px;
      color: rgba(0,0,0,.82);
      background: rgba(255,255,255,.62);
      display:inline-block;
      padding: 3px 10px;
      border-radius: 999px;
    }
    .openBtn{
      flex: 0 0 auto;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 13px;
      text-decoration:none;
      white-space: nowrap;
    }

    /* Expandable body */
    .dockBody{
      max-height: 0;
      overflow: hidden;
      transition: max-height .28s ease;
      border-top: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }
    .dockBodyInner{
      padding: 10px 12px 14px 12px;
    }
    .hint{
      font-size: 12px;
      color: rgba(255,255,255,.82);
      margin: 0 0 8px 0;
    }
    iframe.sc{
      width: 100%;
      height: 120px; /* compact widget */
      border: 0;
      border-radius: 18px;
      background: rgba(255,255,255,.04);
    }

    .expanded .dockBody{ max-height: 260px; } /* enough to reveal widget */

    /* Loading banner overlay (hanging, not full screen; blurred background visible) */
    .overlay{
      position: fixed;
      inset: 0;
      display:flex;
      align-items: center;
      justify-content: center;
      padding: calc(18px + var(--safe-top)) 14px calc(18px + var(--safe-bottom)) 14px;
      box-sizing:border-box;
      z-index: 50;
      opacity: 1;
      pointer-events: auto;
      transition: opacity .35s ease;
    }
    .overlay.hide{
      opacity: 0;
      pointer-events: none;
    }
    .overlayBackdrop{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.30);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .coverCard{
      position: relative;
      width: min(78vw, 520px);
      max-height: min(72vh, 820px);
      border-radius: 24px;
      overflow: hidden;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.16);
      transform: translateY(0);
    }
    .coverCard img{
      width: 100%;
      height: auto;
      display:block;
    }

    /* Swipe helper */
    .toast{
      position: fixed;
      left: 12px;
      bottom: calc(14px + var(--safe-bottom));
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.18);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 30;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .25s ease, transform .25s ease;
      pointer-events:none;
    }
    .toast.show{
      opacity: 1;
      transform: translateY(0);
    }

    /* Maintenance: sticky bottom, but only visible after scroll */
    .maint{
      position: fixed;
      left: 12px;
      right: 12px;
      bottom: calc(10px + var(--safe-bottom));
      z-index: 10;
      opacity: 0;
      transform: translateY(10px);
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
    }
    .maint.show{
      opacity: 1;
      transform: translateY(0);
    }
    .maintBox{
      width: min(900px, 100%);
      margin: 0 auto;
      background: rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 16px;
      padding: 10px 12px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size: 13px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: center;
    }
    .chip{
      opacity:.9;
      white-space: nowrap;
    }
    .ok{ color: var(--paper-ok); font-weight: 800; }
    .err{ color: rgba(255,140,140,.95); font-weight: 800; }

    /* Make the stage fill as much as possible on tall screens */
    @media (min-height: 740px){
      .buffer{ height: 9vh; }
      .playerDock{ margin-top: -58px; }
    }
  </style>
</head>
<body>
  <div class="stars" aria-hidden="true"></div>

  <!-- Hanging cover overlay (auto hides once panel is ready) -->
  <div id="overlay" class="overlay" role="status" aria-label="Loading">
    <div class="overlayBackdrop"></div>
    <div class="coverCard" aria-hidden="true">
      <img id="coverImg" src="./manga/chapter-00/cover.jpg" alt="SANCTUM — Cover" />
    </div>
  </div>

  <div class="wrap">
    <div class="stage" id="stage">
      <div class="buffer" aria-hidden="true"></div>

      <div class="panel" id="panel">
        <img id="panelImg" src="./manga/chapter-00/panel01.jpg" alt="Panel 01" />
      </div>

      <div class="buffer" aria-hidden="true"></div>
    </div>

    <!-- Collapsible player dock (collapsed by default) -->
    <div class="playerDock" id="playerDock">
      <div class="dockCard" id="dockCard">
        <div class="dockHeader" id="dockHeader" role="button" aria-expanded="false" tabindex="0">
          <div class="playPill" aria-hidden="true" id="playIcon">
            <!-- play icon -->
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
          </div>

          <div class="trackText">
            <div class="trackTitle" id="trackTitle">SENTINEL</div><br/>
            <div class="trackArtist" id="trackArtist">DAVID RAVENSON</div>
          </div>

          <a class="openBtn" id="openBtn" href="https://soundcloud.com/user-543596862/sentinel-2" target="_blank" rel="noopener">Open on SoundCloud</a>
        </div>

        <div class="dockBody" id="dockBody" aria-hidden="true">
          <div class="dockBodyInner">
            <p class="hint">Tip: tap play inside the SoundCloud player (browser autoplay rules).</p>
            <iframe
              class="sc"
              id="scFrame"
              title="SoundCloud player"
              loading="lazy"
              allow="autoplay"
              src="https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/user-543596862/sentinel-2&auto_play=false&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false&visual=false">
            </iframe>
          </div>
        </div>
      </div>
    </div>

    <!-- Spacer so you can scroll a bit (so maintenance can appear only on scroll) -->
    <div style="height: 120vh;"></div>
  </div>

  <div class="toast" id="toast">Ready. Swipe right to continue.</div>

  <!-- Maintenance (only shows after scrolling down) -->
  <div class="maint" id="maint">
    <div class="maintBox">
      <span class="chip">v0.29.0</span>
      <span class="chip">chapter-00 / panel01</span>
      <span class="chip">audio: chapter-00audio</span>
      <span class="chip" id="paperChip">Paper: <span class="ok">OK ✓</span></span>
      <span class="chip" id="errChip">error: <span class="ok">(none)</span></span>
    </div>
  </div>

  <script>
    // ===== CONFIG =====
    const VERSION = "v0.29.0";
    const CHAPTER = "chapter-00";
    const PANEL_SRC = "./manga/chapter-00/panel01.jpg";
    const COVER_SRC = "./manga/chapter-00/cover.jpg";
    const PAPER_SRC = "./media/ui/manga_paper_bg.png";

    // ===== ELEMENTS =====
    const overlay = document.getElementById("overlay");
    const panelImg = document.getElementById("panelImg");
    const coverImg = document.getElementById("coverImg");
    const toast = document.getElementById("toast");
    const maint = document.getElementById("maint");
    const errChip = document.getElementById("errChip");
    const paperChip = document.getElementById("paperChip");

    const dockCard = document.getElementById("dockCard");
    const dockHeader = document.getElementById("dockHeader");
    const dockBody = document.getElementById("dockBody");
    const playIcon = document.getElementById("playIcon");

    // ===== HELPERS =====
    function setError(msg){
      errChip.innerHTML = 'error: <span class="err">' + msg + '</span>';
    }
    function clearError(){
      errChip.innerHTML = 'error: <span class="ok">(none)</span>';
    }
    function showToast(text){
      toast.textContent = text;
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 2500);
    }

    // ===== ASSET CHECKS (paper) =====
    (function checkPaper(){
      const img = new Image();
      img.onload = () => { paperChip.innerHTML = 'Paper: <span class="ok">OK ✓</span>'; };
      img.onerror = () => { paperChip.innerHTML = 'Paper: <span class="err">MISSING ✗</span>'; setError("paper_missing"); };
      img.src = PAPER_SRC + "?v=" + Date.now();
    })();

    // ===== LOADING OVERLAY LOGIC =====
    // Keep cover "hanging" while panel loads, then fade out.
    coverImg.src = COVER_SRC;

    function hideOverlaySoon(){
      // small cinematic pause so it reads as a banner, not a flash
      setTimeout(() => overlay.classList.add("hide"), 650);
    }

    panelImg.src = PANEL_SRC;

    let panelLoaded = false;
    panelImg.addEventListener("load", () => {
      panelLoaded = true;
      clearError();
      hideOverlaySoon();
      showToast("Ready. Swipe right to continue.");
    });

    panelImg.addEventListener("error", () => {
      setError("panel_404");
      // still hide overlay after a moment so user isn't trapped
      setTimeout(() => overlay.classList.add("hide"), 900);
    });

    // Safety: never trap user on overlay if something hangs
    setTimeout(() => {
      if (!panelLoaded) {
        setError("panel_timeout");
        overlay.classList.add("hide");
      }
    }, 6500);

    // ===== COLLAPSIBLE PLAYER (collapsed by default) =====
    let expanded = false;

    function setExpanded(state){
      expanded = state;
      dockCard.classList.toggle("expanded", expanded);
      dockHeader.setAttribute("aria-expanded", expanded ? "true" : "false");
      dockBody.setAttribute("aria-hidden", expanded ? "false" : "true");

      // swap play icon
      playIcon.innerHTML = expanded
        ? '<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>'
        : '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>';
    }

    // Click anywhere on header (except the link) toggles
    dockHeader.addEventListener("click", (e) => {
      const a = e.target.closest("a");
      if (a) return;
      setExpanded(!expanded);
    });

    dockHeader.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        setExpanded(!expanded);
      }
    });

    // ===== SWIPE RIGHT TO CONTINUE =====
    // (simple page-stack placeholder: swipe right -> next hash)
    let x0 = null;
    let y0 = null;

    function onTouchStart(e){
      const t = e.touches[0];
      x0 = t.clientX;
      y0 = t.clientY;
    }
    function onTouchMove(e){
      if (x0 === null || y0 === null) return;
      const t = e.touches[0];
      const dx = t.clientX - x0;
      const dy = t.clientY - y0;

      // only horizontal intent
      if (Math.abs(dx) > Math.abs(dy) && dx > 60) {
        x0 = y0 = null;

        // NEXT PAGE (placeholder)
        // You can later map this to chapter-00/panel02, or chapter-01/cover, etc.
        location.hash = "#chapter-00/panel02";
        showToast("Next page (placeholder).");
      }
    }

    window.addEventListener("touchstart", onTouchStart, {passive:true});
    window.addEventListener("touchmove", onTouchMove, {passive:true});

    // ===== MAINTENANCE: only after scroll =====
    function onScroll(){
      const show = window.scrollY > 90;
      maint.classList.toggle("show", show);
    }
    window.addEventListener("scroll", onScroll, {passive:true});
    onScroll(); // init
  </script>
</body>
</html>