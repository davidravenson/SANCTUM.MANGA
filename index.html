<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SANCTUM — Reader Core</title>

  <style>
    :root{
      --v: "v0.41.0";
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);

      --bg:#000;
      --max-w: 860px;
      --shadow: 0 16px 40px rgba(0,0,0,.35);
    }

    html,body{
      margin:0;
      height:100%;
      background:#000;
      color:#fff;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      overflow:hidden;
      user-select:none;
      -webkit-user-select:none;
      -webkit-touch-callout:none;
    }

    /* ===============================
       SEEKER GATE (SIMPLIFIED)
    =============================== */
    .gate{
      position:fixed;
      inset:0;
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      padding:16px;
      box-sizing:border-box;
    }

    .gateCard{
      width: min(92vw, 420px);
      border-radius: 22px;
      padding: 18px;
      background: rgba(0,0,0,.75);
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 30px 70px rgba(0,0,0,.6);
    }

    .keeper{
      font-weight: 900;
      letter-spacing:.06em;
      opacity:.9;
      margin-bottom: 6px;
    }

    .gateQ{
      font-size: 14px;
      opacity:.85;
      margin-bottom: 14px;
    }

    .codePanel{
      display:flex;
      gap:8px;
      justify-content:center;
      margin-bottom: 14px;
    }

    .codePanel input{
      width:46px;
      height:54px;
      text-align:center;
      font-size:22px;
      font-weight:900;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.08);
      color:#fff;
      outline:none;
    }

    .sliderWrap{
      margin: 14px 0;
      padding:12px;
      border-radius:16px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.16);
    }

    .sliderTop{
      display:flex;
      justify-content:space-between;
      font-size:12px;
      opacity:.85;
      margin-bottom:6px;
    }

    input[type=range]{
      width:100%;
    }

    .gateBtn{
      width:100%;
      margin-top:12px;
      padding:14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.15);
      color:#fff;
      font-weight:900;
      letter-spacing:.04em;
      cursor:pointer;
    }

    .gateBtn:disabled{
      opacity:.4;
      cursor:not-allowed;
    }

    .gateMsg{
      margin-top:10px;
      font-size:12px;
      min-height:16px;
      opacity:.8;
    }

    /* ===============================
       READER
    =============================== */
    .stage{
      position:relative;
      height:100%;
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .frame{
      width: min(100vw, var(--max-w));
      height:100%;
      overflow:hidden;
      background:#000;
    }

    .track{
      display:flex;
      height:100%;
      transition: transform .3s ease;
    }

    .slide{
      flex:0 0 100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .slide img{
      width:100%;
      height:100%;
      object-fit:contain;
      background:#000;
      pointer-events:none;
    }

    .hud{
      position:fixed;
      top:12px;
      left:12px;
      font-weight:900;
      opacity:.9;
      z-index:50;
    }
  </style>
</head>

<body>

<!-- SEEKER GATE -->
<div id="gate" class="gate">
  <div class="gateCard">
    <div class="keeper">KEEPER</div>
    <div class="gateQ">Do you have the tethercode to enter?</div>

    <div class="codePanel">
      <input maxlength="1" />
      <input maxlength="1" />
      <input maxlength="1" />
      <input maxlength="1" />
    </div>

    <div class="sliderWrap">
      <div class="sliderTop">
        <span>Human verify</span>
        <span id="targetLbl">target: —</span>
      </div>
      <input id="slider" type="range" min="0" max="100" value="0" />
    </div>

    <button id="enterBtn" class="gateBtn" disabled>ENTER SANCTUM</button>
    <div id="gateMsg" class="gateMsg"></div>
  </div>
</div>

<!-- HUD -->
<div class="hud" id="hud">page 01 / 01</div>

<!-- STAGE -->
<div class="stage">
  <div class="frame">
    <div class="track" id="track"></div>
  </div>
</div>

<script>
(function(){
  /* ===============================
     GATE LOGIC
  =============================== */
  const gate = document.getElementById("gate");
  const codeInputs = [...document.querySelectorAll(".codePanel input")];
  const slider = document.getElementById("slider");
  const targetLbl = document.getElementById("targetLbl");
  const btn = document.getElementById("enterBtn");
  const msg = document.getElementById("gateMsg");

  const TARGET = 20 + Math.floor(Math.random()*61);
  targetLbl.textContent = "target: " + TARGET;

  codeInputs.forEach((i,idx)=>{
    i.addEventListener("input", ()=>{
      if(i.value && idx < 3) codeInputs[idx+1].focus();
      checkGate();
    });
  });

  slider.addEventListener("input", checkGate);

  function checkGate(){
    const codeOk = codeInputs.every(i => i.value.match(/^\d$/));
    const sliderOk = Math.abs(slider.value - TARGET) <= 2;

    btn.disabled = !(codeOk && sliderOk);

    msg.textContent = !codeOk
      ? "Enter a 4-digit tethercode."
      : !sliderOk
        ? "Match the slider to the target."
        : "Verified.";
  }

  btn.addEventListener("click", ()=>{
    gate.style.display = "none";
    initReader();
  });

  /* ===============================
     READER
  =============================== */
  function initReader(){
    const track = document.getElementById("track");
    const hud = document.getElementById("hud");

    const BASE = "./manga/chapter-00/SANCTUMPILOTBYDAVIDRAVENSON";
    const EXT = ".jpg";

    let pages = [];
    let index = 0;

    function addPage(n){
      const img = new Image();
      img.src = BASE + n + EXT;
      img.onload = ()=>{
        const slide = document.createElement("div");
        slide.className = "slide";
        slide.appendChild(img);
        track.appendChild(slide);
        pages.push(n);
        updateHud();
        addPage(n+1);
      };
    }

    function updateHud(){
      hud.textContent =
        "page " + String(index+1).padStart(2,"0") +
        " / " + String(pages.length).padStart(2,"0");
    }

    addPage(0);

    let startX=0;
    track.addEventListener("touchstart", e=>{
      startX = e.touches[0].clientX;
    });

    track.addEventListener("touchend", e=>{
      const dx = e.changedTouches[0].clientX - startX;
      if(dx < -40 && index < pages.length-1) index++;
      if(dx > 40 && index > 0) index--;
      track.style.transform = "translateX(" + (-index*100) + "%)";
      updateHud();
    });
  }
})();
</script>

</body>
</html>