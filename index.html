<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SANCTUM — Pilot</title>

  <style>
    :root{
      --paper-bg: url("./media/ui/manga_paper_bg.png");
    }

    html, body{
      margin:0;
      padding:0;
      height:100%;
      background:#000;
      color:#fff;
      font-family: system-ui, sans-serif;
      touch-action:auto;
    }

    /* Paper texture background */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      z-index:-1;
      background-image: var(--paper-bg);
      background-size: cover;
      background-position: center;
      background-repeat:no-repeat;
    }

    .wrap{
      min-height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
      padding:12px;
      box-sizing:border-box;
    }

    .panel{
      width:100%;
      max-width:900px;
      position:relative;
      overflow:hidden;
      background:rgba(0,0,0,0.18);
    }

    .panel img{
      width:100%;
      display:block;
      background:#000;
    }

    .hud{
      position:absolute;
      left:12px;
      bottom:12px;
      font-size:12px;
      opacity:0;
      background:rgba(0,0,0,0.45);
      padding:6px 10px;
      border-radius:10px;
      transition:opacity 250ms ease;
      pointer-events:none;
    }
    .hud.visible{ opacity:0.9; }

    .toolbar{
      width:100%;
      max-width:900px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border-radius:16px;
      background:rgba(10,10,10,0.55);
      border:1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(6px);
    }

    .trackName{
      flex:1;
      font-size:13px;
      line-height:1.25;
      white-space:pre-line;
      opacity:0.95;
      overflow:hidden;
    }

    /* Play / Volume ring */
    .ringWrap{
      width:72px;
      height:72px;
      position:relative;
      display:grid;
      place-items:center;
      touch-action:none;
    }

    .ring{
      position:absolute;
      inset:0;
      border-radius:50%;
      background:conic-gradient(#fff 0deg, rgba(255,255,255,0.14) 0deg);
      -webkit-mask: radial-gradient(circle, transparent 60%, #000 61%);
              mask: radial-gradient(circle, transparent 60%, #000 61%);
      pointer-events:none;
    }

    .centerBtn{
      width:46px;
      height:46px;
      border-radius:50%;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(20,20,20,0.95);
      display:grid;
      place-items:center;
      cursor:pointer;
    }

    .centerBtn svg{
      width:20px;
      height:20px;
      fill:#fff;
    }
  </style>
</head>

<body>

<audio id="bg-audio" preload="auto"></audio>

<div class="wrap">

  <div class="panel" id="panelArea">
    <img id="panelImg" src="" alt="SANCTUM Panel">
    <div class="hud" id="hud">Loading…</div>
  </div>

  <div class="toolbar">
    <div class="trackName" id="trackName"></div>

    <div class="ringWrap" id="ringWrap">
      <div class="ring" id="ring"></div>
      <button class="centerBtn" id="centerBtn"></button>
    </div>
  </div>

</div>

<script>
/* =======================
   CONFIG / PLACEHOLDERS
======================= */
const CHAPTER = 0;            // Pilot = chapter-00
const TOTAL_PANELS = 20;
const AUDIO_VERSION = 1;

/* RAW GitHub audio (IMPORTANT) */
const AUDIO_SRC =
  "https://raw.githubusercontent.com/davidravenson/SANCTUM.MANGA/master/media/audio/chapter-00/instrumental.mp3";

/* Display text only */
const TRACK_TITLE = "Arcangel (Placeholder)";
const TRACK_ARTIST = "— (Artist later)";

/* =======================
   ELEMENTS
======================= */
const audio = document.getElementById("bg-audio");
const panelImg = document.getElementById("panelImg");
const panelArea = document.getElementById("panelArea");
const hud = document.getElementById("hud");
const ring = document.getElementById("ring");
const ringWrap = document.getElementById("ringWrap");
const centerBtn = document.getElementById("centerBtn");
const trackNameEl = document.getElementById("trackName");

/* =======================
   ICONS
======================= */
const ICON_PLAY = `
<svg viewBox="0 0 24 24">
  <path d="M8 6.8v10.4c0 .9 1 1.4 1.7.9l9-5.2c.7-.4.7-1.4 0-1.8l-9-5.2c-.7-.4-1.7.1-1.7.9z"/>
</svg>`;
const ICON_PAUSE = `
<svg viewBox="0 0 24 24">
  <path d="M8 6h3v12H8zM13 6h3v12h-3z"/>
</svg>`;

function updateIcon(){
  centerBtn.innerHTML = audio.paused ? ICON_PLAY : ICON_PAUSE;
}

/* =======================
   AUDIO SETUP
======================= */
function setupAudio(){
  audio.innerHTML = "";
  const src = document.createElement("source");
  src.src = `${AUDIO_SRC}?v=${AUDIO_VERSION}`;
  src.type = "audio/mpeg";
  audio.appendChild(src);

  trackNameEl.textContent = `${TRACK_TITLE}\n${TRACK_ARTIST}`;
  audio.volume = 0.4;
  updateIcon();
}

centerBtn.addEventListener("click", async ()=>{
  if(audio.paused){
    try{ await audio.play(); }catch(e){}
  }else{
    audio.pause();
  }
  updateIcon();
});

audio.addEventListener("play", updateIcon);
audio.addEventListener("pause", updateIcon);

/* =======================
   VOLUME RING
======================= */
function setVolume(v){
  v = Math.max(0, Math.min(1, v));
  audio.volume = v;
  const deg = Math.round(360 * v);
  ring.style.background =
    `conic-gradient(#fff ${deg}deg, rgba(255,255,255,0.14) ${deg}deg)`;
}
setVolume(0.4);

/* =======================
   PANELS
======================= */
let panelIndex = 1;
const chapterFolder = `./manga/chapter-${String(CHAPTER).padStart(2,"0")}/`;
const panelFile = i =>
  `${chapterFolder}panel${String(i).padStart(2,"0")}.jpg`;

function renderPanel(){
  panelImg.src = panelFile(panelIndex);
  hud.textContent = `Panel ${panelIndex} / ${TOTAL_PANELS}`;
}

panelImg.onerror = ()=>{
  hud.textContent = "Panel not found";
  hud.classList.add("visible");
};

/* =======================
   SWIPE
======================= */
let sx=0, sy=0, t0=0;

panelArea.addEventListener("touchstart", e=>{
  if(e.touches.length>1) return;
  const t=e.touches[0];
  sx=t.clientX; sy=t.clientY; t0=Date.now();
  hud.classList.add("visible");
});

panelArea.addEventListener("touchend", e=>{
  const t=e.changedTouches[0];
  const dx=t.clientX-sx;
  const dy=t.clientY-sy;
  const dt=Date.now()-t0;

  if(Math.abs(dx)>40 && Math.abs(dx)>Math.abs(dy)*1.2 && dt<700){
    if(dx<0 && panelIndex<TOTAL_PANELS) panelIndex++;
    if(dx>0 && panelIndex>1) panelIndex--;
    renderPanel();
  }
  setTimeout(()=>hud.classList.remove("visible"),2000);
});

/* =======================
   INIT
======================= */
window.addEventListener("load", ()=>{
  setupAudio();
  renderPanel();
  audio.play().catch(()=>{});
});
</script>

</body>
</html>