<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SANCTUM — Reader</title>

  <style>
    :root{
      --v: "v0.28.2";
      --bg-paper: url("media/ui/manga_paper_bg.png");
      --ink: #111;
      --glass: rgba(255,255,255,.62);
      --glass2: rgba(255,255,255,.40);
      --shadow: 0 10px 30px rgba(0,0,0,.28);
      --radius: 18px;
      --safe-b: env(safe-area-inset-bottom, 0px);
      --safe-t: env(safe-area-inset-top, 0px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #0b0b0b;
      color: var(--ink);
      overflow-x:hidden;
    }

    /* Page background (paper texture) */
    .bg{
      position:fixed;
      inset:0;
      background-image: var(--bg-paper);
      background-size: cover;
      background-position: center;
      background-repeat:no-repeat;
      transform: translateZ(0);
    }

    /* Main layout */
    .wrap{
      position:relative;
      min-height:100%;
      padding: calc(10px + var(--safe-t)) 0 calc(20px + var(--safe-b));
    }

    /* Reader panel area: full width, no rounded “white card” around panel */
    .panelStage{
      width: 100%;
      margin: 0;
      padding: 0;
    }
    .panelImg{
      width: 100vw;
      max-width: 100%;
      height: auto;
      display:block;
      margin: 0;
      border: 0;
      border-radius: 0;
      box-shadow: none;
      background: transparent;
      user-select:none;
      -webkit-user-drag:none;
      touch-action: pan-y; /* allow vertical scroll + we detect horizontal swipes */
    }

    /* Info bubble (auto hide) */
    .hint{
      position: fixed;
      left: 14px;
      bottom: calc(112px + var(--safe-b));
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(0,0,0,.55);
      color: #fff;
      font-size: 14px;
      line-height: 1.25;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .25s ease, transform .25s ease;
      pointer-events:none;
      max-width: 78vw;
      z-index: 30;
    }
    .hint.show{
      opacity: 1;
      transform: translateY(0);
    }

    /* Minimal audio bar */
    .audioBar{
      width: min(920px, 96vw);
      margin: 12px auto 0;
      padding: 10px 10px 12px;
      border-radius: var(--radius);
      background: rgba(255,255,255,.58);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .audioTop{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 8px;
    }
    .trackInfo{
      color:#000;
      font-weight: 800;
      letter-spacing: .2px;
      line-height: 1.05;
      font-size: 18px;
    }
    .trackInfo small{
      display:block;
      font-weight: 650;
      opacity:.85;
      font-size: 14px;
      margin-top: 3px;
    }
    .scBtn{
      appearance:none;
      border: 1px solid rgba(0,0,0,.18);
      background: rgba(255,255,255,.55);
      color:#000;
      font-weight:700;
      border-radius: 999px;
      padding: 10px 14px;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,.12);
      white-space:nowrap;
    }
    .scBtn:active{ transform: translateY(1px); }

    .scFrame{
      width:100%;
      height: 110px; /* more minimal */
      border:0;
      border-radius: 14px;
      overflow:hidden;
      background: rgba(255,255,255,.55);
    }

    /* Maintenance/debug (hidden until scroll) */
    .maintenance{
      position: fixed;
      left: 10px;
      right: 10px;
      bottom: calc(10px + var(--safe-b));
      z-index: 40;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.55);
      color: rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      font-size: 14px;
      line-height: 1.25;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;

      opacity: 0;
      transform: translateY(8px);
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
    }
    .maintenance.show{
      opacity: 1;
      transform: translateY(0);
      pointer-events:auto;
    }
    .maintenance .dot{ opacity:.55; }
    .maintenance .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      opacity:.95;
    }
    .maintenance .err{
      color: #fff;
      opacity: .95;
    }
    .maintenance .ok{
      color: #b6ffb6;
      font-weight: 800;
    }

    /* Loader overlay: “banner hung in front”, background visible + blurry */
    .loader{
      position: fixed;
      inset: 0;
      z-index: 100;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px;
    }
    .loader.hidden{ display:none; }

    .loaderBlur{
      position:absolute;
      inset:0;
      /* show the same background, but blurred + slightly darker */
      background-image: var(--bg-paper);
      background-size: cover;
      background-position: center;
      filter: blur(16px);
      transform: scale(1.06);
      opacity: .95;
    }
    .loaderDim{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.40);
    }

    .coverBanner{
      position:relative;
      width: min(520px, 78vw);
      max-height: 82vh;
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 18px 55px rgba(0,0,0,.55);
      transform: translateY(-2vh); /* subtle “hung” feel */
    }
    .coverBanner img{
      width:100%;
      height:auto;
      display:block;
      background: rgba(255,255,255,.06);
    }

    /* Tiny spacer to allow “scroll down to reveal maintenance” */
    .debugSpacer{
      height: 520px;
      opacity:0;
      pointer-events:none;
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>

  <!-- LOADER (no text container) -->
  <div id="loader" class="loader" aria-hidden="true">
    <div class="loaderBlur"></div>
    <div class="loaderDim"></div>

    <div class="coverBanner" aria-label="Cover banner">
      <img id="coverImg" alt="Cover" />
    </div>
  </div>

  <div class="wrap" id="wrap">
    <main class="panelStage" id="panelStage">
      <img id="panelImg" class="panelImg" alt="Panel" />
    </main>

    <section class="audioBar" aria-label="Audio">
      <div class="audioTop">
        <div class="trackInfo" id="trackInfo">
          SENTINEL
          <small>DAVID RAVENSON</small>
        </div>
        <button class="scBtn" id="openSC" type="button">Open on SoundCloud</button>
      </div>

      <iframe
        id="scFrame"
        class="scFrame"
        allow="autoplay"
        scrolling="no"
        frameborder="no"
        loading="lazy">
      </iframe>
    </section>

    <!-- invisible spacer (so user can intentionally scroll to see maintenance) -->
    <div class="debugSpacer"></div>
  </div>

  <div id="hint" class="hint">Ready.<br>Swipe right to continue.</div>

  <!-- Maintenance/debug (shows only after scroll) -->
  <div id="maintenance" class="maintenance" role="status" aria-live="polite">
    <span class="mono" id="ver"></span>
    <span class="dot">•</span>
    <span class="mono" id="route"></span>
    <span class="dot">•</span>
    <span class="mono" id="audioFolder"></span>
    <span class="dot">•</span>
    <span class="err mono" id="errLine">error: (none)</span>
    <span class="ok" id="paperOK" style="display:none;">Paper OK ✓</span>
  </div>

  <script>
    // ===== Versioning =====
    const VERSION = "v0.28.2";

    // ===== Paths / Config =====
    // Manga
    const chapterId = "chapter-00";
    const coverPath = `manga/${chapterId}/cover.jpg`;
    const panel1Path = `manga/${chapterId}/panel01.jpg`;

    // Audio folder rename (as requested)
    const audioFolder = "chapter-00audio"; // renamed folder in media/audio/
    // SoundCloud track (embed) — user provided:
    const soundcloudTrackUrl = "https://soundcloud.com/user-543596862/sentinel-2";
    const soundcloudOpenUrl = soundcloudTrackUrl;

    // ===== Elements =====
    const loader = document.getElementById("loader");
    const coverImg = document.getElementById("coverImg");
    const panelImg = document.getElementById("panelImg");
    const hint = document.getElementById("hint");
    const maintenance = document.getElementById("maintenance");
    const verEl = document.getElementById("ver");
    const routeEl = document.getElementById("route");
    const audioFolderEl = document.getElementById("audioFolder");
    const errLine = document.getElementById("errLine");
    const paperOK = document.getElementById("paperOK");
    const scFrame = document.getElementById("scFrame");
    const openSC = document.getElementById("openSC");

    // ===== Persistent error display (as requested) =====
    function setError(msg){
      errLine.textContent = `error: ${msg}`;
    }

    // ===== Maintenance reveal on scroll =====
    function updateMaintenanceVisibility(){
      const y = window.scrollY || document.documentElement.scrollTop || 0;
      if (y > 120) maintenance.classList.add("show");
      else maintenance.classList.remove("show");
    }
    window.addEventListener("scroll", updateMaintenanceVisibility, {passive:true});

    // ===== Hash route system (page-stack) =====
    // We keep it simple: cover is only a LOADER overlay (not a page).
    // Pages: panel01 now. (You can extend with panel02..)
    function parseHash(){
      const raw = (location.hash || "").replace(/^#/, "").trim();
      // expected: chapter-00/panel01
      const [ch, page] = raw.split("/").map(s => (s||"").trim());
      return {
        chapter: ch || chapterId,
        page: page || "panel01"
      };
    }

    function setHash(chapter, page){
      location.hash = `#${chapter}/${page}`;
    }

    // ===== Loader behavior =====
    let loaderMinVisibleMs = 650; // short, but noticeable
    let loaderStart = 0;

    function showLoader(){
      loaderStart = performance.now();
      loader.classList.remove("hidden");
    }
    function hideLoaderSoon(){
      const elapsed = performance.now() - loaderStart;
      const wait = Math.max(0, loaderMinVisibleMs - elapsed);
      window.setTimeout(() => loader.classList.add("hidden"), wait);
    }

    // ===== Paper bg check (optional) =====
    // Just a small sanity: if bg image fails, we don't hard error, but we report.
    function checkPaper(){
      const test = new Image();
      test.onload = () => { paperOK.style.display = "inline"; };
      test.onerror = () => { setError("paper bg not found: media/ui/manga_paper_bg.png"); };
      test.src = "media/ui/manga_paper_bg.png";
    }

    // ===== SoundCloud embed =====
    function buildSoundcloudEmbed(url){
      // Minimal player look; still SoundCloud's iframe.
      const params = new URLSearchParams({
        url,
        color: "#111111",
        auto_play: "false",
        hide_related: "true",
        show_comments: "false",
        show_user: "false",
        show_reposts: "false",
        show_teaser: "false",
        visual: "false"
      });
      return `https://w.soundcloud.com/player/?${params.toString()}`;
    }

    // ===== Swipe right to continue =====
    let touchStartX = 0, touchStartY = 0, touching = false;

    function onTouchStart(e){
      if (!e.touches || !e.touches.length) return;
      touching = true;
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    }
    function onTouchEnd(e){
      if (!touching) return;
      touching = false;

      const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      if (!t) return;

      const dx = t.clientX - touchStartX;
      const dy = t.clientY - touchStartY;

      // mostly horizontal + right swipe
      if (Math.abs(dx) > 70 && Math.abs(dy) < 60 && dx > 0){
        goNext();
      }
    }

    function showHintOnce(){
      hint.classList.add("show");
      window.setTimeout(() => hint.classList.remove("show"), 1400);
    }

    // ===== Page navigation (extendable) =====
    const pages = ["panel01"]; // extend later: ["panel01","panel02","panel03"...]
    function goNext(){
      const {chapter, page} = parseHash();
      const idx = pages.indexOf(page);
      const next = pages[Math.min(pages.length - 1, (idx === -1 ? 0 : idx + 1))];
      if (next !== page) setHash(chapter, next);
      else {
        // reached end, just show hint softly
        showHintOnce();
      }
    }

    // ===== Render =====
    async function render(){
      const {chapter, page} = parseHash();

      // maintenance text (even if hidden until scroll)
      verEl.textContent = VERSION;
      routeEl.textContent = `${chapter} / ${page}`;
      audioFolderEl.textContent = `audio: ${audioFolder}`;

      // Always show loader (cover) briefly on navigation
      showLoader();

      // set cover image path
      coverImg.src = coverPath;

      // load target panel
      let panelSrc = panel1Path;
      if (page === "panel01") panelSrc = `manga/${chapter}/panel01.jpg`;

      // Attempt to load panel, report errors
      await new Promise((resolve) => {
        const tmp = new Image();
        tmp.onload = () => {
          panelImg.src = panelSrc;
          setError("(none)");
          resolve();
        };
        tmp.onerror = () => {
          panelImg.src = "";
          setError(`panel not found: ${panelSrc}`);
          resolve();
        };
        tmp.src = panelSrc + `?v=${encodeURIComponent(VERSION)}`;
      });

      // Cover load sanity (do not block)
      coverImg.onerror = () => setError(`cover not found: ${coverPath}`);

      // Hide loader after minimum time
      hideLoaderSoon();

      // hint for swipe
      showHintOnce();
    }

    // ===== Init =====
    function init(){
      // Bind swipe
      document.addEventListener("touchstart", onTouchStart, {passive:true});
      document.addEventListener("touchend", onTouchEnd, {passive:true});

      // SoundCloud
      scFrame.src = buildSoundcloudEmbed(soundcloudTrackUrl);
      openSC.addEventListener("click", () => window.open(soundcloudOpenUrl, "_blank", "noopener,noreferrer"));

      // Paper check
      checkPaper();

      // Default hash
      if (!location.hash) setHash(chapterId, "panel01");

      // Render on hash change
      window.addEventListener("hashchange", render);

      // Maintenance visibility
      updateMaintenanceVisibility();

      // First render
      render();
    }

    init();
  </script>
</body>
</html>
```0